patterns:
- pattern: architecture/*
  insights:
  - When integrating multiple specialized parsers (Claude, Codex, VerMAS), add a _convert_parser_session_to_base()
    function that maps parser-specific message formats to a common BaseSession.turns
    structure. This enables downstream features like --include-conversation to work
    uniformly across all sources without source-specific handling in display code.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - architecture
  - technical
  sample_count: 1
- pattern: git-workflow/*
  insights:
  - 'When code exists in git worktrees but was never committed to main, recover it
    by: (1) copying files from worktree to main, (2) running tests to verify functionality,
    (3) using ''git add'' explicitly on each deliverable file, (4) verifying tracking
    with ''git ls-files --error-unmatch'', (5) committing with descriptive message
    referencing the original action item IDs. This workflow recovered 2000+ lines
    of parser code (VerMAS: 830 lines, Codex: 514 lines) plus 1793 lines of tests.'
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - git-workflow
  - process
  sample_count: 1
- pattern: verification/*
  insights:
  - When prior workflows failed due to verification gaps, fix the verification script
    before starting new work. This workflow fixed pre-signal-check.sh (commit e2182f8)
    to verify deliverables are git-tracked before signaling done. This prevented the
    same failure mode that caused 4 consecutive incomplete tasks in Cycle 3.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - verification
  - process
  sample_count: 1
- pattern: testing/*
  insights:
  - When implementing a minimal stub CLI, existing integration tests may expect full
    functionality. Rather than implementing extra features, mark tests as skipped
    with clear documentation (e.g., '@pytest.mark.skip - requires full CLI, not minimal
    stub'). This maintains spec compliance while documenting what will be needed in
    future tasks.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - testing
  - technical
  sample_count: 1
- pattern: code-recovery/*
  insights:
  - When integrating components developed in git worktrees, first verify and commit
    the code to main before wiring them into the core system. This workflow successfully
    recovered 1,140 lines of Codex parser code and 2,030 lines of VerMAS parser code
    that existed in worktrees but were never committed. The recovery step (commits
    d9e3b74, becde1e) preceded the integration step (commit 9d038df).
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - code-recovery
  - process
  sample_count: 1
- pattern: infrastructure/*
  insights:
  - Agent workflows can fail catastrophically when the underlying tmux session terminates
    unexpectedly. For long-running tasks (>10 minutes), ensure tmux sessions are configured
    with appropriate keepalive settings and consider implementing agent heartbeat
    monitoring to detect session death early.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - infrastructure
  - process
  sample_count: 1
- pattern: error-handling/*
  insights:
  - 'The ''agents died'' error with ''Dead roles: [dev]'' indicates the workflow orchestrator
    correctly detected the missing agent but lacks retry/recovery logic. Consider
    adding agent restart capability for recoverable failures versus fatal abort.'
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - error-handling
  - technical
  sample_count: 1
- pattern: compatibility/*
  insights:
  - When two parts of a system use similar but incompatible data models, add compatibility
    properties to the newer model rather than changing all consumers. The BaseSession
    in parsers/models.py gained properties like 'id' (aliasing session_id), 'start_time'
    (aliasing timestamp), and 'tools_used' (converting tool_calls) to maintain compatibility
    with models/__init__.py:BaseSession consumers.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - compatibility
  - technical
  sample_count: 1
- pattern: workflow-reliability/*
  insights:
  - Workflows running 77+ minutes (4666 seconds) are vulnerable to tmux session timeouts
    or agent process death. The watcher confirmed completion at 09:43:59, but all
    agents (watcher, dev, qa) died before clean workflow exit. Consider implementing
    session keepalive mechanisms, checkpoint-based recovery, or reducing workflow
    duration by breaking into smaller increments.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - workflow-reliability
  - process
  sample_count: 1
- pattern: code-review/*
  insights:
  - QA effectively caught spec mismatches (Typer vs required Click dependency) that
    dev overlooked in initial implementations. Explicit requirements (e.g., 'use click>=8.0')
    should be verified early in QA reviews before functionality testing. This prevents
    fundamental dependency mismatches that would cause integration issues downstream.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - code-review
  - process
  sample_count: 1
- pattern: dependencies/*
  insights:
  - Plain 'uv run pytest' failed without pytest-cov plugin; 'uv run --extra dev pytest'
    was required for full test execution. Projects should document required test dependencies
    and consider making pytest-cov optional to reduce friction.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - dependencies
  - technical
  sample_count: 1
- pattern: workflow-resilience/*
  insights:
  - When tmux sessions terminate unexpectedly, agents die without opportunity to save
    state or signal failure. This creates opaque failures reported as 'agents died'
    without diagnostic information. Long-running tasks are particularly vulnerable
    to this infrastructure failure mode.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - workflow-resilience
  - process
  sample_count: 1
- pattern: task-decomposition/*
  insights:
  - CLI implementation that combines argument parsing, command dispatch, and business
    logic in a single task has a high failure rate. Breaking CLI tasks into discrete
    layers (verify structure, minimal entrypoint, subcommand stub, wire to existing
    logic) dramatically improves success rate. The follow-up cycle-5 with decomposed
    tasks succeeded.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - task-decomposition
  - process
  sample_count: 1
- pattern: failure-recovery/*
  insights:
  - When cycle-4 'implement-cli-skeleton' failed, the system had already evolved a
    decomposition plan. Cycle-5 'add-analyze-subcommand-stub' succeeded with 186 tests
    passing. This validates that incremental task breakdown is an effective recovery
    strategy after infrastructure or scope failures.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - failure-recovery
  - process
  sample_count: 1
- pattern: performance/*
  insights:
  - When parsing file-discovery-based sources (like VerMAS scanning .vermas/ directories),
    implement a _parsed_dirs cache to track already-processed directories. Without
    this, scanning multiple files from the same source creates duplicate sessions
    in aggregated results. Add reset_cache() function for test isolation.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - performance
  - technical
  sample_count: 1
- pattern: debugging/*
  insights:
  - When tests fail due to missing optional plugins like pytest-cov specified in pyproject.toml
    addopts, use 'PYTHONPATH=src python -m pytest -q -o addopts=""' to override and
    skip coverage requirements. This enables running tests in environments without
    the full dev dependency stack.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - debugging
  - technical
  sample_count: 1
- pattern: integration/*
  insights:
  - When adding new session sources to a discovery system, update SESSION_PATTERNS
    to include the new directory patterns (.claude/, .codex/, .vermas/) AND update
    parse_session_file() dispatch logic to route to the correct parser based on file
    path context. QA should explicitly verify both discovery and parsing for each
    new source.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - integration
  - technical
  sample_count: 1
- pattern: task-planning/*
  insights:
  - This is at least the 4th failure of 'implement-cli-skeleton' task (Cycles 3-5
    and now Cycle 6). Prior analysis showed CLI already exists in main (src/session_insights/cli.py).
    Tasks should be invalidated when discovery shows deliverables already exist, preventing
    repeated failures on stale work items.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - task-planning
  - process
  sample_count: 1
- pattern: workflow-lifecycle/*
  insights:
  - The workflow completed all tasks successfully with QA approval and 'complete'
    signals, but was marked failed because agent processes died afterward. The DSL
    workflow runner tracks agent liveness independently from task completion, meaning
    successful workflows can be marked 'failed' if agents die before clean shutdown.
    Implement explicit workflow_complete handling that terminates monitoring once
    all tasks signal complete.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - workflow-lifecycle
  - process
  sample_count: 1
- pattern: specification-compliance/*
  insights:
  - Dev initially implemented with typer/rich/pydantic when spec explicitly required
    click>=8.0. Over-building creates drift from requirements and extra rework during
    QA. Always start with the minimal spec (dependencies explicitly listed in task
    definition) and resist adding conveniences not specified in requirements.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - specification-compliance
  - process
  sample_count: 1
