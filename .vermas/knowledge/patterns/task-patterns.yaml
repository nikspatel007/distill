patterns:
- pattern: architecture/*
  insights:
  - When integrating multiple specialized parsers (Claude, Codex, VerMAS), add a _convert_parser_session_to_base()
    function that maps parser-specific message formats to a common BaseSession.turns
    structure. This enables downstream features like --include-conversation to work
    uniformly across all sources without source-specific handling in display code.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - architecture
  - technical
  sample_count: 1
- pattern: git-workflow/*
  insights:
  - 'When code exists in git worktrees but was never committed to main, recover it
    by: (1) copying files from worktree to main, (2) running tests to verify functionality,
    (3) using ''git add'' explicitly on each deliverable file, (4) verifying tracking
    with ''git ls-files --error-unmatch'', (5) committing with descriptive message
    referencing the original action item IDs. This workflow recovered 2000+ lines
    of parser code (VerMAS: 830 lines, Codex: 514 lines) plus 1793 lines of tests.'
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - git-workflow
  - process
  sample_count: 1
- pattern: verification/*
  insights:
  - When prior workflows failed due to verification gaps, fix the verification script
    before starting new work. This workflow fixed pre-signal-check.sh (commit e2182f8)
    to verify deliverables are git-tracked before signaling done. This prevented the
    same failure mode that caused 4 consecutive incomplete tasks in Cycle 3.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - verification
  - process
  sample_count: 1
- pattern: testing/*
  insights:
  - Initial implementation passed local tests but QA review identified missing parser
    dispatch logic, incomplete directory scanning, and missing message-to-turn conversion
    for --include-conversation. Two review cycles with specific issue lists enabled
    targeted fixes. Integration tests should verify feature flags like --include-conversation
    work end-to-end, not just that parsers exist.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - testing
  - process
  sample_count: 1
- pattern: code-recovery/*
  insights:
  - When integrating components developed in git worktrees, first verify and commit
    the code to main before wiring them into the core system. This workflow successfully
    recovered 1,140 lines of Codex parser code and 2,030 lines of VerMAS parser code
    that existed in worktrees but were never committed. The recovery step (commits
    d9e3b74, becde1e) preceded the integration step (commit 9d038df).
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - code-recovery
  - process
  sample_count: 1
- pattern: infrastructure/*
  insights:
  - Agent workflows can fail catastrophically when the underlying tmux session terminates
    unexpectedly. For long-running tasks (>10 minutes), ensure tmux sessions are configured
    with appropriate keepalive settings and consider implementing agent heartbeat
    monitoring to detect session death early.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - infrastructure
  - process
  sample_count: 1
- pattern: error-handling/*
  insights:
  - 'The ''agents died'' error with ''Dead roles: [dev]'' indicates the workflow orchestrator
    correctly detected the missing agent but lacks retry/recovery logic. Consider
    adding agent restart capability for recoverable failures versus fatal abort.'
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - error-handling
  - technical
  sample_count: 1
- pattern: compatibility/*
  insights:
  - When two parts of a system use similar but incompatible data models, add compatibility
    properties to the newer model rather than changing all consumers. The BaseSession
    in parsers/models.py gained properties like 'id' (aliasing session_id), 'start_time'
    (aliasing timestamp), and 'tools_used' (converting tool_calls) to maintain compatibility
    with models/__init__.py:BaseSession consumers.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - compatibility
  - technical
  sample_count: 1
- pattern: workflow-reliability/*
  insights:
  - Workflow signaled 'complete' with successful commit (a3380b2) but DSL reported
    failure due to 'agents died' after workflow concluded. The 77-minute duration
    suggests possible timeout or resource exhaustion. Workflows should handle graceful
    shutdown and distinguish between agent death during vs after task execution.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - workflow-reliability
  - process
  sample_count: 1
- pattern: code-review/*
  insights:
  - Initial implementation used Typer instead of required Click framework. QA caught
    this mismatch and integration test failures in first review. Developer then fixed
    framework choice and added missing --since option. Two review cycles achieved
    112 passing tests before approval.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - code-review
  - process
  sample_count: 1
- pattern: dependencies/*
  insights:
  - Plain 'uv run pytest' failed without pytest-cov plugin; 'uv run --extra dev pytest'
    was required for full test execution. Projects should document required test dependencies
    and consider making pytest-cov optional to reduce friction.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - dependencies
  - technical
  sample_count: 1
- pattern: workflow-resilience/*
  insights:
  - When tmux sessions terminate unexpectedly, agents die without opportunity to save
    state or signal failure. This creates opaque failures reported as 'agents died'
    without diagnostic information. Long-running tasks are particularly vulnerable
    to this infrastructure failure mode.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - workflow-resilience
  - process
  sample_count: 1
- pattern: task-decomposition/*
  insights:
  - CLI implementation that combines argument parsing, command dispatch, and business
    logic in a single task has a high failure rate. Breaking CLI tasks into discrete
    layers (verify structure, minimal entrypoint, subcommand stub, wire to existing
    logic) dramatically improves success rate. The follow-up cycle-5 with decomposed
    tasks succeeded.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - task-decomposition
  - process
  sample_count: 1
- pattern: failure-recovery/*
  insights:
  - When cycle-4 'implement-cli-skeleton' failed, the system had already evolved a
    decomposition plan. Cycle-5 'add-analyze-subcommand-stub' succeeded with 186 tests
    passing. This validates that incremental task breakdown is an effective recovery
    strategy after infrastructure or scope failures.
  revision_rate: null
  success_rate: 0.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - failure-recovery
  - process
  sample_count: 1
- pattern: performance/*
  insights:
  - When parsing file-discovery-based sources (like VerMAS scanning .vermas/ directories),
    implement a _parsed_dirs cache to track already-processed directories. Without
    this, scanning multiple files from the same source creates duplicate sessions
    in aggregated results. Add reset_cache() function for test isolation.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - performance
  - technical
  sample_count: 1
- pattern: debugging/*
  insights:
  - When tests fail due to missing optional plugins like pytest-cov specified in pyproject.toml
    addopts, use 'PYTHONPATH=src python -m pytest -q -o addopts=""' to override and
    skip coverage requirements. This enables running tests in environments without
    the full dev dependency stack.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - debugging
  - technical
  sample_count: 1
- pattern: integration/*
  insights:
  - When adding new session sources to a discovery system, update SESSION_PATTERNS
    to include the new directory patterns (.claude/, .codex/, .vermas/) AND update
    parse_session_file() dispatch logic to route to the correct parser based on file
    path context. QA should explicitly verify both discovery and parsing for each
    new source.
  revision_rate: null
  success_rate: 1.0
  avg_duration: null
  recommended_workflow: null
  tags:
  - integration
  - technical
  sample_count: 1
